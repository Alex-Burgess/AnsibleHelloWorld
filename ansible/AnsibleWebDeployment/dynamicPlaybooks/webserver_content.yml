---
- name: Content
  vars:
    hosts_var: "{{ dynamic_tag_var | default('webservers') }}"
  hosts: "{{ hosts_var }}"
  serial: "{{ rolling_update_var | default('1') }}"
  tasks:
  - name: Create content source directory for helloworld.com
    file: path=/var/www/html/helloworld.com/html state=directory
  - name: Synchronize all helloworld.com content
    synchronize:
      src: /app/applications/helloworld.com/html
      dest: /var/www/html/helloworld.com
      delete: yes
      recursive: yes
  - name: Create configuration directory
    file: path=/var/www/html/helloworld.com/config state=directory
  - name: Copy production application config file if production inventory file
    copy:
      src: /app/applications/helloworld.com/config/app.ini.prod
      dest: /var/www/html/helloworld.com/config/app.ini
      owner: apache
      group: apache
      mode: 0644
    when: ( 'prod' in inventory_file ) or ( 'prod' in hosts_var )
  - name: Copy staging application config file if staging inventory file
    copy:
      src: /app/applications/helloworld.com/config/app.ini.staging
      dest: /var/www/html/helloworld.com/config/app.ini
      owner: apache
      group: apache
      mode: 0644
    when: ( 'staging' in inventory_file ) or ( 'staging' in hosts_var )
  - name: Copy test application config file if test inventory file
    copy:
      src: /app/applications/helloworld.com/config/app.ini.test
      dest: /var/www/html/helloworld.com/config/app.ini
      owner: apache
      group: apache
      mode: 0644
    when: ( 'test' in inventory_file ) or ( 'test' in hosts_var )
